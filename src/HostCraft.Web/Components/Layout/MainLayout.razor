@inherits LayoutComponentBase
@inject AuthenticationStateProvider AuthStateProvider
@inject IWebAuthService AuthService
@inject NavigationManager Navigation

<div class="app-container">
    <aside class="sidebar">
        <NavMenu />
    </aside>

    <main class="main-content">
        @Body
    </main>
</div>

@code {
    private bool IsAuthenticated;
    private bool IsAdmin;
    private Models.User? CurrentUser;

    protected override async Task OnInitializedAsync()
    {
        await LoadAuthenticationState();
    }

    private async Task LoadAuthenticationState()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        IsAuthenticated = authState.User?.Identity?.IsAuthenticated == true;

        if (IsAuthenticated && AuthStateProvider is Services.HostCraftAuthenticationStateProvider hostCraftAuthProvider)
        {
            CurrentUser = hostCraftAuthProvider.GetCurrentUser();
            IsAdmin = hostCraftAuthProvider.IsAdmin();
        }
        else
        {
            CurrentUser = null;
            IsAdmin = false;
        }

        StateHasChanged();
    }

    private async Task HandleLogout()
    {
        await AuthService.LogoutAsync();
        Navigation.NavigateTo("/login", forceLoad: true);
    }
}
